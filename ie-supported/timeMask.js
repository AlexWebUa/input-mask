"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function _createClass(t,e,i){return e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i),t}var TimeMask=function(){function t(e){_classCallCheck(this,t),this.init(e)}return _createClass(t,[{key:"init",value:function(t){t.inputId?(this.input=document.getElementById(t.inputId),t.allowSeconds?this.allowSeconds=t.allowSeconds:this.allowSeconds=!1,t.placeholder?this.placeholder=t.placeholder:this.placeholder="ЧЧ:ММ",t.errorBlock?this.errorBlock=t.errorBlock:this.errorBlock=null,this.allowSeconds?(this.inputShadow=[null,null,":",null,null,":",null,null],this.placeholder="ЧЧ:ММ:СС"):(this.inputShadow=[null,null,":",null,null],this.placeholder="ЧЧ:ММ"),this.isEmpty=!0,window.simplified||(this.hangEvents(),this.render())):console.error("Неверный id тега")}},{key:"hangEvents",value:function(){var t=this;this.input.onclick=function(){t.input.selectionStart=0,t.input.selectionEnd=0,t.input.onclick=null},isMobile?this.input.oninput=function(e){return t.keyPress(e)}:this.input.onkeydown=function(e){return t.keyPress(e)}}},{key:"keyPress",value:function(t){var e;isMobile?"deleteContentBackward"===t.inputType?e="Backspace":"deleteContentForward"===t.inputType?e="Delete":"insertText"===t.inputType&&(e=t.data):e=t.key,this.isDecimal(e)?(isMobile?document.execCommand("undo"):t.preventDefault(),e=parseInt(e),this.typeDigit(e,this.input.selectionStart)):"Backspace"===e?(isMobile?document.execCommand("undo"):t.preventDefault(),this.remove()):isMobile||"ArrowLeft"===e||"ArrowRight"===e||"Tab"===e||"F5"===e?isMobile&&document.execCommand("undo"):t.preventDefault()}},{key:"typeDigit",value:function(t,e){this.isEmpty=!1,":"!==this.inputShadow[e]?(0===e&&(t<=2&&(2!==t||2===t&&this.inputShadow[1]<4)?this.validate(t,e):this.inputShadow[e]=null),1===e&&(this.inputShadow[0]<2?this.validate(t,e):t<=3?this.validate(t,e):this.inputShadow[e]=null),3===e&&(t<=5?this.validate(t,e):this.inputShadow[e]=null),4===e&&this.validate(t,e),this.allowSeconds&&(6===e&&(t<=5?this.validate(t,e):this.inputShadow[e]=null),7===e&&this.validate(t,e))):(this.input.selectionStart=e+1,this.input.selectionEnd=e+1,this.typeDigit(t,this.input.selectionStart))}},{key:"validate",value:function(t,e){this.inputShadow[e]=t,this.render(e+1)}},{key:"remove",value:function(){var t=this.input.selectionStart,e=this.input.selectionEnd,i=t-1;if(t===e&&i>=0&&(":"!==this.inputShadow[i]?this.inputShadow[i]=null:(this.input.selectionStart--,this.input.selectionEnd--,this.remove()),this.render(i)),t!==e){for(var n=t;n<=e-1;n++)n<0&&(n=0),":"!==this.inputShadow[n]&&(this.inputShadow[n]=null);this.render(t)}this.isEmpty=this.checkEmpty(),this.isEmpty&&this.render(0)}},{key:"render",value:function(t){if(this.isEmpty)this.input.value=this.placeholder;else{this.input.value=null;for(var e=0;e<this.inputShadow.length;e++)null===this.inputShadow[e]?this.input.value+=0===e||1===e?"Ч":3===e||4===e?"М":6===e||7===e?"С":":":":"!==this.inputShadow[e]?this.input.value+=this.inputShadow[e]:this.input.value+=":"}this.input.selectionStart=t,this.input.selectionEnd=t}},{key:"checkEmpty",value:function(){var t;t=this.allowSeconds?[null,null,":",null,null,":",null,null]:[null,null,":",null,null];for(var e=0;e<this.inputShadow.length;e++)if(this.inputShadow[e]!==t[e])return!1;return!0}},{key:"isDecimal",value:function(t){return new RegExp(/^\d+$/).test(t)}},{key:"displayError",value:function(t){if(null===this.errorBlock){var e=document.createElement("span"),i="error_"+this.input.id;e.setAttribute("id",i),e.innerHTML=t,e.style.color="red",this.input.after(e),this.errorBlock=document.getElementById(i)}else this.errorBlock.innerHTML=t}},{key:"clearError",value:function(){null!==this.errorBlock&&(this.errorBlock.innerHTML="")}},{key:"getDate",value:function(){if(window.simplified){this.clearError();if(this.allowSeconds?new RegExp(/(?:[01]\d|2[0123]):(?:[012345]\d):(?:[012345]\d)/).test(this.input.value):new RegExp(/(?:[01]\d|2[0123]):(?:[012345]\d)/).test(this.input.value)){this.clearError();var t=10*parseInt(this.input.value[0])+parseInt(this.input.value[1]),e=10*parseInt(this.input.value[3])+parseInt(this.input.value[4]),i=0;this.allowSeconds&&(i=10*parseInt(this.input.value[6])+parseInt(this.input.value[7]));var n=new Date;return n.setHours(parseInt(t)),n.setMinutes(parseInt(e)),this.allowSeconds&&n.setSeconds(parseInt(i)),n}this.displayError("Неверно введено время!")}else if(-1!==!this.inputShadow.indexOf(null)){var s=parseInt(10*this.inputShadow[0]+this.inputShadow[1]),l=parseInt(10*this.inputShadow[3]+this.inputShadow[4]),r=0;this.allowSeconds&&(r=parseInt(10*this.inputShadow[6]+this.inputShadow[7]));var u=new Date;return u.setHours(s),u.setMinutes(l),this.allowSeconds&&u.setSeconds(r),u}return!1}}]),t}();
