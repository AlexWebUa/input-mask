"use strict";function _classCallCheck(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function _createClass(t,i,n){return i&&_defineProperties(t.prototype,i),n&&_defineProperties(t,n),t}var DateMask=function(){function t(i){_classCallCheck(this,t),this.init(i)}return _createClass(t,[{key:"init",value:function(t){t.inputId?(this.input=document.getElementById(t.inputId),t.nullChar?this.nullChar=t.nullChar:this.nullChar="_",t.splitter?this.splitter=t.splitter:this.splitter=".",t.oldFormat?this.oldFormat=t.oldFormat:this.oldFormat=!1,t.minYear?this.minYear=t.minYear:this.minYear=-4e3,t.maxYear?this.maxYear=t.maxYear:this.maxYear=3e3,t.placeholder?this.placeholder=t.placeholder:this.placeholder="ДД.ММ.ГГГГ",t.errorBlock?this.errorBlock=t.errorBlock:this.errorBlock=null,this.oldFormat?this.inputShadow=[null,null,this.splitter,null,null,this.splitter,null,null,null,null]:this.inputShadow=[null,null,this.splitter,null,null,this.splitter," ",null,null,null,null],this.monthRules=[31,28,31,30,31,30,31,31,30,31,30,31],this.isBC=!1,this.isEmpty=!0,window.simplified||(this.hangEvents(),this.render())):console.error("Неверный id тега")}},{key:"hangEvents",value:function(){var t=this;this.input.onclick=function(){t.input.selectionStart=0,t.input.selectionEnd=0,t.input.onclick=null},isMobile?this.input.oninput=function(i){return t.keyPress(i)}:this.input.onkeydown=function(i){return t.keyPress(i)}}},{key:"keyPress",value:function(t){var i;isMobile?"deleteContentBackward"===t.inputType?i="Backspace":"deleteContentForward"===t.inputType?i="Delete":"insertText"===t.inputType&&(i=t.data):i=t.key,this.isDecimal(i)?(isMobile?document.execCommand("undo"):t.preventDefault(),i=parseInt(i),this.typeDigit(i,this.input.selectionStart)):"Backspace"===i?(isMobile?document.execCommand("undo"):t.preventDefault(),this.remove()):this.oldFormat||" "!==i&&"-"!==i?isMobile||"ArrowLeft"===i||"ArrowRight"===i||"Tab"===i||"F5"===i?isMobile&&document.execCommand("undo"):t.preventDefault():7===this.input.selectionStart||6===this.input.selectionStart?(this.minYear&&this.minYear>=0?this.inputShadow[6]=" ":this.inputShadow[6]=i,isMobile?document.execCommand("undo"):t.preventDefault(),this.render(7)):isMobile?document.execCommand("undo"):t.preventDefault()}},{key:"typeDigit",value:function(t,i){this.isEmpty=!1,this.inputShadow[i]!==this.splitter?(0===i&&t<4&&(0===t&&0===this.inputShadow[i+1]?this.inputShadow[i]=null:this.validate(t,i)),1===i&&(this.inputShadow[0]<3?0===t&&0===this.inputShadow[i-1]?this.inputShadow[i]=null:this.validate(t,i):3===this.inputShadow[0]&&t<2&&this.validate(t,i)),3===i&&t<2&&(0===t&&0===this.inputShadow[i+1]?this.inputShadow[i]=null:this.validate(t,i)),4===i&&(this.inputShadow[3]>0&&t<3?this.validate(t,i):0===this.inputShadow[3]&&this.validate(t,i)),this.oldFormat&&i>=6&&i<=9&&this.validate(t,i),this.oldFormat||(5!==i&&6!==i||this.typeDigit(t,7),i>=7&&i<=10&&this.validate(t,i))):(this.input.selectionStart=i+1,this.input.selectionEnd=i+1,this.typeDigit(t,this.input.selectionStart))}},{key:"validate",value:function(t,i){this.inputShadow[i]=t;var n,e,s,l=this.getCurrentBlock(i);if(null!==this.inputShadow[0]&&null!==this.inputShadow[1]&&(n=10*this.inputShadow[0]+this.inputShadow[1]),null!==this.inputShadow[3]&&null!==this.inputShadow[4]&&(e=10*this.inputShadow[3]+this.inputShadow[4]),this.oldFormat?null!==this.inputShadow[6]&&null!==this.inputShadow[7]&&null!==this.inputShadow[8]&&null!==this.inputShadow[9]&&(s=parseInt(this.inputShadow.slice(6,10).join(""))):null!==this.inputShadow[7]&&null!==this.inputShadow[8]&&null!==this.inputShadow[9]&&null!==this.inputShadow[10]&&(s=parseInt(this.inputShadow.slice(7,11).join(""))),"day"===l)n?29===n&&2===e?s&&s%4==0?this.render(i+1):s?this.inputShadow[i]=null:this.render(i+1):e&&n<=this.monthRules[e-1]?this.render(i+1):e&&n>this.monthRules[e-1]?this.inputShadow[i]=null:!e&&n>31||"00"===n?this.inputShadow[i]=null:this.render(i+1):this.render(i+1);else if("month"===l)e?29===n&&2===e?s&&s%4==0?this.render(i+1):s?this.inputShadow[i]=null:this.render(i+1):n&&n<=this.monthRules[e-1]?this.render(i+1):n&&n>this.monthRules[e-1]?this.inputShadow[i]=null:e>12?this.inputShadow[i]=null:this.render(i+1):this.render(i+1);else if("year"===l)if(s)if(29===n&&2===e&&s%4==0)this.render(i+1);else if(29===n&&2===e&&s%4!=0)this.inputShadow[i]=null;else if(this.minYear&&this.maxYear){var h,r;this.oldFormat?(h=parseInt(this.inputShadow.slice(6,10).map(function(t){return null===t?9:t}).join("")),r=parseInt(this.inputShadow.slice(6,10).map(function(t){return null===t?0:t}).join(""))):r=h=parseInt(this.inputShadow.slice(6,11).map(function(t){return null===t?0:t}).join(""));var a=this.minYear,u=this.maxYear;this.oldFormat&&(this.minYear<0&&this.isBC?(a=0,u=Math.abs(this.minYear)):this.minYear<0&&!this.isBC&&(a=0)),h>=a&&r<=u&&this.render(i+1)}else this.render(i+1);else if(this.minYear&&this.maxYear){var o,d;this.oldFormat?(o=parseInt(this.inputShadow.slice(6,10).map(function(t){return null===t?9:t}).join("")),d=parseInt(this.inputShadow.slice(6,10).map(function(t){return null===t?0:t}).join(""))):d=o=parseInt(this.inputShadow.slice(6,11).map(function(t){return null===t?0:t}).join(""));var p=this.minYear,c=this.maxYear;this.oldFormat&&(this.minYear<0&&this.isBC?(p=0,c=Math.abs(this.minYear)):this.minYear<0&&!this.isBC&&(p=0)),o>=p&&d<=c&&this.render(i+1)}else this.render(i+1)}},{key:"remove",value:function(){var t=this.input.selectionStart,i=this.input.selectionEnd,n=t-1;if(t===i&&n>=0&&(this.inputShadow[n]!==this.splitter&&" "!==this.inputShadow[n]&&"-"!==this.inputShadow[n]?this.inputShadow[n]=null:" "===this.inputShadow[n]||"-"===this.inputShadow[n]?this.inputShadow[n]=" ":(this.input.selectionStart--,this.input.selectionEnd--,this.remove()),this.render(n)),t!==i){for(var e=t;e<=i-1;e++)e<0&&(e=0),this.inputShadow[e]!==this.splitter&&" "!==this.inputShadow[e]&&"-"!==this.inputShadow[e]?this.inputShadow[e]=null:" "!==this.inputShadow[e]&&"-"!==this.inputShadow[e]||(this.inputShadow[e]=" ");this.render(t)}this.isEmpty=this.checkEmpty(),this.isEmpty&&this.render(0)}},{key:"render",value:function(t){var i=this;this.isEmpty?this.input.value=this.placeholder:(this.input.value=null,this.inputShadow.map(function(t){return i.input.value+=null===t?i.nullChar:t})),this.input.selectionStart=t,this.input.selectionEnd=t}},{key:"checkEmpty",value:function(){var t;t=this.oldFormat?[null,null,this.splitter,null,null,this.splitter,null,null,null,null]:[null,null,this.splitter,null,null,this.splitter," ",null,null,null,null];for(var i=0;i<this.inputShadow.length;i++)if(this.inputShadow[i]!==t[i])return!1;return!0}},{key:"changeBC",value:function(t){this.oldFormat&&(this.isBC=t)}},{key:"getCurrentBlock",value:function(t){return 0===t||1===t?"day":3===t||4===t?"month":t>=6?"year":void 0}},{key:"isDecimal",value:function(t){return new RegExp(/^\d+$/).test(t)}},{key:"displayError",value:function(t){if(null===this.errorBlock){var i=document.createElement("span"),n="error_"+this.input.id;i.setAttribute("id",n),i.innerHTML=t,i.style.color="red",this.input.after(i),this.errorBlock=document.getElementById(n)}else this.errorBlock.innerHTML=t}},{key:"clearError",value:function(){null!==this.errorBlock&&(this.errorBlock.innerHTML="")}},{key:"getDate",value:function(){if(window.simplified){var t=moment(this.input.value,"DD.MM.Y",!0);this.clearError();try{if(!t.isValid())throw new SyntaxError;this.clearError();var i=t.year();if(this.minYear<=i&&i<=this.maxYear)return t.toDate();this.displayError("Неверный год")}catch(i){switch(t.invalidAt()){case 0:this.displayError("Неверный год");break;case 1:this.displayError("Неверный месяц");break;case 2:this.displayError("Неверный день");break;default:this.displayError("Неверная дата")}}}else if(-1!==!this.inputShadow.indexOf(null)){var n,e=parseInt(10*this.inputShadow[0]+this.inputShadow[1]),s=parseInt(10*this.inputShadow[3]+this.inputShadow[4])-1;this.oldFormat?(n=parseInt(this.inputShadow.slice(6,10).join("")),this.isBC&&(n*=-1)):n=parseInt(this.inputShadow.slice(6,11).join(""));var l=new Date(n,s,e);return n<100&&l.setFullYear(n),l}return!1}}]),t}();
